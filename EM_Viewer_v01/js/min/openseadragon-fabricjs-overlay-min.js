!function(){if(!window.OpenSeadragon)return void console.error("[openseadragon-canvas-overlay] requires OpenSeadragon");OpenSeadragon.Viewer.prototype.fabricjsOverlay=function(){return this._fabricjsOverlayInfo?this._fabricjsOverlayInfo:(this._fabricjsOverlayInfo=new i(this),this._fabricjsOverlayInfo)};var i=function(i){var t=this;this._viewer=i,this._containerWidth=0,this._containerHeight=0,this._canvasdiv=document.createElement("div"),this._canvasdiv.style.position="absolute",this._canvasdiv.style.left=0,this._canvasdiv.style.top=0,this._canvasdiv.style.width="100%",this._canvasdiv.style.height="100%",this._viewer.canvas.appendChild(this._canvasdiv),this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","osd-overlaycanvas"),this._canvasdiv.appendChild(this._canvas),this.resize(),this._fabricCanvas=new fabric.Canvas("osd-overlaycanvas"),this._fabricCanvas.selection=!1,this._fabricCanvas.on("mouse:down",function(i){i.target&&(i.e.preventDefault(),i.e.stopPropagation())}),this._viewer.addHandler("update-viewport",function(){t.resize(),t.resizecanvas()}),this._viewer.addHandler("open",function(){t.resize(),t.resizecanvas()}),this.resize()};i.prototype={canvas:function(){return this._canvas},fabricCanvas:function(){return this._fabricCanvas},clear:function(){this._fabricCanvas.clearAll()},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._canvasdiv.setAttribute("width",this._containerWidth),this._canvas.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._canvasdiv.setAttribute("height",this._containerHeight),this._canvas.setAttribute("height",this._containerHeight))},resizecanvas:function(){var i=new OpenSeadragon.Point(0,0),t=this._viewer.viewport.getZoom(!0),e=this._viewer.world.getItemAt(0),a=e.viewportToImageZoom(t);this._fabricCanvas.setWidth(this._containerWidth),this._fabricCanvas.setHeight(this._containerHeight),this._fabricCanvas.setZoom(a);var n=e.imageToWindowCoordinates(i),s=Math.round(n.x),r=Math.round(n.y),h=this._canvasdiv.getBoundingClientRect();this._fabricCanvas.absolutePan(new fabric.Point(h.left-s,h.top-r))}}}();